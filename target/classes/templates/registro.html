<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - Tienda de Ropa</title>
    <link th:href="@{/css/index.css}" rel="stylesheet">
    <link rel="stylesheet"th:href="@{/css/navbar.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>


    <nav class="navbar">
        <div class="container">
            <a class="nav-link" th:href="@{/login}">Iniciar Sesión</a>    
            <a class="nav-link" th:href="@{/registro}">Registrarse</a>
        </div>
    </nav>

    <div class="container-mt-5">
        <div class="row-justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4 class="text-center">Crear Cuenta</h4>
                    </div>
                    <div class="card-body">
                        <form id="registroForm" th:action="@{/registro}" th:object="${usuario}" method="post">
                                                    
                            <!-- Mostrar errores generales -->
                            <div th:if="${error}" class="alert alert-danger">
                                <span th:text="${error}"></span>
                            </div>
                            
                            <!-- Mensaje de éxito -->
                            <div th:if="${success}" class="alert alert-success">
                                <span th:text="${success}"></span>
                            </div>
                            
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="nombre" 
                                    th:field="*{nombre}" 
                                    placeholder="Tu nombre" 
                                    required>
                                <div th:if="${#fields.hasErrors('nombre')}" class="text-danger mt-1">
                                    <small th:errors="*{nombre}"></small>
                                </div>
                                <span id="nombreError" class="error-message" style="color: red; font-size: 0.85rem; display: block; margin-top: 5px;"></span>
                            </div>
                            
                            <div class="mb-3">
                                <label for="apellido" class="form-label">Apellido</label>
                                <input type="text" class="form-control" id="apellido" 
                                    th:field="*{apellido}" 
                                    placeholder="Tu apellido" 
                                    required>
                                <div th:if="${#fields.hasErrors('apellido')}" class="text-danger mt-1">
                                    <small th:errors="*{apellido}"></small>
                                </div>
                                <span id="apellidoError" class="error-message" style="color: red; font-size: 0.85rem; display: block; margin-top: 5px;"></span>
                            </div>
                            
                            <div class="mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" 
                                    th:field="*{email}" 
                                    placeholder="tu@gmail.com" 
                                    required>
                                <div th:if="${#fields.hasErrors('email')}" class="text-danger mt-1">
                                    <small th:errors="*{email}"></small>
                                </div>
                                <span id="emailError" class="error-message" style="color: red; font-size: 0.85rem; display: block; margin-top: 5px;"></span>
                            </div>
                            
                            <div class="mb-3">
                                <label for="password" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="password" 
                                    th:field="*{password}" 
                                    placeholder="••••••••" 
                                    required minlength="6">
                                <div th:if="${#fields.hasErrors('password')}" class="text-danger mt-1">
                                    <small th:errors="*{password}"></small>
                                </div>
                                <span id="passwordError" class="error-message" style="color: red; font-size: 0.85rem; display: block; margin-top: 5px;"></span>
                                
                                <!-- Indicador de requisitos de contraseña -->
                                <div class="password-requirements" style="margin-top: 10px; font-size: 0.85rem;">
                                    <div><strong>Requisitos de contraseña:</strong></div>
                                    <div id="passwordRequirements">
                                        <div id="lengthReq">• Mínimo 6 caracteres, máximo 30</div>
                                        <div id="uppercaseReq">• Al menos una mayúscula</div>
                                        <div id="lowercaseReq">• Al menos una minúscula</div>
                                        <div id="numberReq">• Al menos un número</div>
                                        <div id="specialReq">• Al menos un carácter especial</div>
                                    </div>
                                </div>
                            </div>
                            
                            <input type="hidden" th:field="*{rol}" value="CLIENTE">
                            
                            <button type="submit" class="btn btn-primary w-100 mt-3">
                                Crear Cuenta
                            </button>
                        </form>
                        
                        <div class="text-center mt-3">
                            <p>¿Ya tienes cuenta? <a th:href="@{/login}">Inicia sesión aquí</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script para partículas de fondo -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 12;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Tamaño y posición aleatorios
                const size = Math.random() * 50 + 15;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const delay = Math.random() * 4;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.opacity = Math.random() * 0.2 + 0.1;
                
                particlesContainer.appendChild(particle);
            }

            // Mejorar experiencia del formulario
            const form = document.querySelector('form');
            const submitBtn = form.querySelector('button[type="submit"]');
            
            form.addEventListener('submit', function() {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<div class="loading"></div> Creando cuenta...';
                }
            });

            // Validación en tiempo real
            const inputs = form.querySelectorAll('input[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.style.borderColor = 'var(--accent-danger)';
                    } else {
                        this.style.borderColor = 'var(--border-light)';
                    }
                });
                
                input.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.style.borderColor = 'var(--accent-primary)';
                    }
                });
            });
        });
    </script>

    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const registroForm = document.getElementById('registroForm');
        const nombreInput = document.getElementById('nombre');
        const apellidoInput = document.getElementById('apellido');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        
        const nombreError = document.getElementById('nombreError');
        const apellidoError = document.getElementById('apellidoError');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        
        // Elementos de requisitos de contraseña
        const lengthReq = document.getElementById('lengthReq');
        const uppercaseReq = document.getElementById('uppercaseReq');
        const lowercaseReq = document.getElementById('lowercaseReq');
        const numberReq = document.getElementById('numberReq');
        const specialReq = document.getElementById('specialReq');
        
        // Función para validar nombre
        // Función para validar nombre
function validateNombre(nombre) {
    // Limpiar espacios extras y normalizar
    nombre = nombre.trim().replace(/\s+/g, ' ');
    
    // Verificar que no esté vacío
    if (nombre === '') {
        return { valid: false, message: "El nombre es requerido" };
    }
    
    // Verificar que solo contenga letras y espacios
    if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(nombre)) {
        return { valid: false, message: "El nombre solo puede contener letras y espacios" };
    }
    
    // Verificar número de palabras (1-2)
    const palabras = nombre.split(/\s+/).filter(palabra => palabra.length > 0);
    if (palabras.length < 1 || palabras.length > 2) {
        return { valid: false, message: "El nombre debe tener 1 o 2 palabras" };
    }
    
    // Verificar que las dos palabras no sean iguales (si hay dos)
    if (palabras.length === 2 && palabras[0].toLowerCase() === palabras[1].toLowerCase()) {
        return { valid: false, message: "Las dos palabras del nombre no pueden ser iguales" };
    }
    
    // Verificar que no tenga más de 3 letras iguales seguidas
    for (let palabra of palabras) {
        for (let i = 0; i < palabra.length - 3; i++) {
            if (palabra[i] === palabra[i+1] && palabra[i] === palabra[i+2] && palabra[i] === palabra[i+3]) {
                return { valid: false, message: "El nombre no puede tener más de 3 letras iguales seguidas" };
            }
        }
    }
    
    // VALIDACIONES MEJORADAS PARA NOMBRES CON SENTIDO
    
    // Verificar longitud mínima de cada palabra (mínimo 2 caracteres)
    for (let palabra of palabras) {
        if (palabra.length < 2) {
            return { valid: false, message: "Cada palabra del nombre debe tener al menos 2 letras" };
        }
    }
    
    // Verificar longitud máxima de cada palabra (máximo 15 caracteres)
    for (let palabra of palabras) {
        if (palabra.length > 15) {
            return { valid: false, message: "Cada palabra del nombre debe tener máximo 15 letras" };
        }
    }
    
    // Verificar que tenga al menos una vocal en cada palabra
    for (let palabra of palabras) {
        if (!/[aeiouáéíóúAEIOUÁÉÍÓÚ]/.test(palabra)) {
            return { valid: false, message: "Cada palabra debe contener al menos una vocal" };
        }
    }
    
    // Verificar proporción vocal/consonante más estricta
    for (let palabra of palabras) {
        const vocales = (palabra.match(/[aeiouáéíóúAEIOUÁÉÍÓÚ]/g) || []).length;
        const consonantes = (palabra.match(/[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZñÑ]/g) || []).length;
        const totalLetras = palabra.length;
        
        // Para palabras de 3-4 letras: máximo 75% del mismo tipo
        if (totalLetras >= 3 && totalLetras <= 4) {
            if (vocales / totalLetras > 0.75 || consonantes / totalLetras > 0.75) {
                return { valid: false, message: "El nombre debe tener una combinación balanceada de vocales y consonantes" };
            }
        }
        
        // Para palabras de 5+ letras: máximo 70% del mismo tipo
        if (totalLetras >= 5) {
            if (vocales / totalLetras > 0.7 || consonantes / totalLetras > 0.7) {
                return { valid: false, message: "El nombre debe tener una combinación balanceada de vocales y consonantes" };
            }
        }
    }
    
    // Verificar secuencias de consonantes inválidas
    const secuenciasConsonantesInvalidas = [
        /[bcdfghjklmnpqrstvwxyz]{4,}/i, // 4+ consonantes seguidas
        /^[bcdfghjklmnpqrstvwxyz]{3,}/i, // 3+ consonantes al inicio
        /[bcdfghjklmnpqrstvwxyz]{3,}$/i, // 3+ consonantes al final
    ];
    
    for (let palabra of palabras) {
        for (let secuencia of secuenciasConsonantesInvalidas) {
            if (secuencia.test(palabra)) {
                return { valid: false, message: "El nombre contiene secuencias de consonantes no válidas" };
            }
        }
    }
    
    // Verificar patrones sin sentido específicos
    const patronesInvalidos = [
        /^(.)\1{2,}$/i, // 3+ letras iguales (aaa, bbb)
        /^(.)\1\s+\1+$/i, // Mismo patrón repetido (aa aa)
        /^[aeiou]{3,}$/i, // Solo vocales (aaa, eee)
        /^[bcdfghjklmnpqrstvwxyz]{3,}$/i, // Solo consonantes (bbb, ccc)
        /^(.)\1(.)\2$/i, // Patrón repetido (aabb)
        /^(.)(.)\1\2$/i, // Patrón espejo (abab)
        /^[^aeiou]{3,}[aeiou]{1}[^aeiou]{3,}$/i, // Muchas consonantes, una vocal, muchas consonantes
    ];
    
    for (let patron of patronesInvalidos) {
        for (let palabra of palabras) {
            if (patron.test(palabra)) {
                return { valid: false, message: "El nombre contiene patrones no válidos" };
            }
        }
    }
    
    // Lista de combinaciones específicas bloqueadas
    const combinacionesInvalidas = [
        'aa aa', 'aaa aaa', 'bb bb', 'cc cc', 'dd dd', 'ee ee', 'ff ff',
        'as ass', 'ab abc', 'test test', 'demo demo', 'qwe qwer',
        'ndja ndksla', 'asdf asdfg', 'qwer qwert', 'zxcv zxcvb',
        'aaaa', 'bbbb', 'cccc', 'dddd', 'eeee', 'ffff',
        'asdf', 'qwer', 'zxcv', 'jklñ', 'poiu', 'lkjh', 'mnbv'
    ];
    
    if (combinacionesInvalidas.includes(nombre.toLowerCase())) {
        return { valid: false, message: "El nombre no es válido" };
    }
    
    // Verificar que no sean teclas adyacentes en el teclado (patrones de teclado)
    const patronesTeclado = [
        /^[asdf]+$/i, /^[qwer]+$/i, /^[zxcv]+$/i, /^[jklñ]+$/i,
        /^[poiu]+$/i, /^[lkjh]+$/i, /^[mnbv]+$/i, /^[yuio]+$/i
    ];
    
    for (let palabra of palabras) {
        for (let patron of patronesTeclado) {
            if (patron.test(palabra.toLowerCase())) {
                return { valid: false, message: "El nombre contiene patrones de teclado no válidos" };
            }
        }
    }
    
    // CORREGIDO: Verificar que solo la primera letra sea mayúscula
    for (let palabra of palabras) {
        // Verificar que la primera letra sea mayúscula
        if (palabra.length > 0 && !/^[A-ZÁÉÍÓÚÑ]/.test(palabra)) {
            return { valid: false, message: "La primera letra de cada palabra debe ser mayúscula" };
        }
        
        // Verificar que el resto de letras sean minúsculas
        if (palabra.length > 1 && !/^[A-ZÁÉÍÓÚÑ][a-záéíóúñ]+$/.test(palabra)) {
            return { valid: false, message: "Solo la primera letra debe ser mayúscula, el resto minúsculas" };
        }
    }
    
    return { valid: true, message: "" };
}

// Función para validar apellido (mismas validaciones que nombre)
function validateApellido(apellido, nombre) {
    // Limpiar espacios extras y normalizar
    apellido = apellido.trim().replace(/\s+/g, ' ');
    
    // Verificar que no esté vacío
    if (apellido === '') {
        return { valid: false, message: "El apellido es requerido" };
    }
    
    // Verificar que solo contenga letras y espacios
    if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(apellido)) {
        return { valid: false, message: "El apellido solo puede contener letras y espacios" };
    }
    
    // Verificar número de palabras (1-2)
    const palabras = apellido.split(/\s+/).filter(palabra => palabra.length > 0);
    if (palabras.length < 1 || palabras.length > 2) {
        return { valid: false, message: "El apellido debe tener 1 o 2 palabras" };
    }
    
    // Verificar que las dos palabras no sean iguales (si hay dos)
    if (palabras.length === 2 && palabras[0].toLowerCase() === palabras[1].toLowerCase()) {
        return { valid: false, message: "Las dos palabras del apellido no pueden ser iguales" };
    }
    
    // Verificar que no sea igual al nombre
    if (nombre.trim().toLowerCase() === apellido.toLowerCase()) {
        return { valid: false, message: "El apellido no puede ser igual al nombre" };
    }
    
    // Verificar que no tenga más de 3 letras iguales seguidas
    for (let palabra of palabras) {
        for (let i = 0; i < palabra.length - 3; i++) {
            if (palabra[i] === palabra[i+1] && palabra[i] === palabra[i+2] && palabra[i] === palabra[i+3]) {
                return { valid: false, message: "El apellido no puede tener más de 3 letras iguales seguidas" };
            }
        }
    }
    
    // APLICAR LAS MISMAS VALIDACIONES ESTRICTAS QUE PARA EL NOMBRE
    
    // Verificar longitud mínima de cada palabra (mínimo 2 caracteres)
    for (let palabra of palabras) {
        if (palabra.length < 2) {
            return { valid: false, message: "Cada palabra del apellido debe tener al menos 2 letras" };
        }
    }
    
    // Verificar longitud máxima de cada palabra (máximo 15 caracteres)
    for (let palabra of palabras) {
        if (palabra.length > 15) {
            return { valid: false, message: "Cada palabra del apellido debe tener máximo 15 letras" };
        }
    }
    
    // Verificar que tenga al menos una vocal en cada palabra
    for (let palabra of palabras) {
        if (!/[aeiouáéíóúAEIOUÁÉÍÓÚ]/.test(palabra)) {
            return { valid: false, message: "Cada palabra debe contener al menos una vocal" };
        }
    }
    
    // Verificar proporción vocal/consonante más estricta
    for (let palabra of palabras) {
        const vocales = (palabra.match(/[aeiouáéíóúAEIOUÁÉÍÓÚ]/g) || []).length;
        const consonantes = (palabra.match(/[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZñÑ]/g) || []).length;
        const totalLetras = palabra.length;
        
        if (totalLetras >= 3 && totalLetras <= 4) {
            if (vocales / totalLetras > 0.75 || consonantes / totalLetras > 0.75) {
                return { valid: false, message: "El apellido debe tener una combinación balanceada de vocales y consonantes" };
            }
        }
        
        if (totalLetras >= 5) {
            if (vocales / totalLetras > 0.7 || consonantes / totalLetras > 0.7) {
                return { valid: false, message: "El apellido debe tener una combinación balanceada de vocales y consonantes" };
            }
        }
    }
    
    // Verificar secuencias de consonantes inválidas
    const secuenciasConsonantesInvalidas = [
        /[bcdfghjklmnpqrstvwxyz]{4,}/i,
        /^[bcdfghjklmnpqrstvwxyz]{3,}/i,
        /[bcdfghjklmnpqrstvwxyz]{3,}$/i,
    ];
    
    for (let palabra of palabras) {
        for (let secuencia of secuenciasConsonantesInvalidas) {
            if (secuencia.test(palabra)) {
                return { valid: false, message: "El apellido contiene secuencias de consonantes no válidas" };
            }
        }
    }
    
    // Verificar patrones sin sentido específicos
    const patronesInvalidos = [
        /^(.)\1{2,}$/i,
        /^(.)\1\s+\1+$/i,
        /^[aeiou]{3,}$/i,
        /^[bcdfghjklmnpqrstvwxyz]{3,}$/i,
        /^(.)\1(.)\2$/i,
        /^(.)(.)\1\2$/i,
        /^[^aeiou]{3,}[aeiou]{1}[^aeiou]{3,}$/i,
    ];
    
    for (let patron of patronesInvalidos) {
        for (let palabra of palabras) {
            if (patron.test(palabra)) {
                return { valid: false, message: "El apellido contiene patrones no válidos" };
            }
        }
    }
    
    // Lista de combinaciones específicas bloqueadas
    const combinacionesInvalidas = [
        'aa aa', 'aaa aaa', 'bb bb', 'cc cc', 'dd dd', 'ee ee', 'ff ff',
        'as ass', 'ab abc', 'test test', 'demo demo', 'qwe qwer',
        'ndja ndksla', 'asdf asdfg', 'qwer qwert', 'zxcv zxcvb',
        'aaaa', 'bbbb', 'cccc', 'dddd', 'eeee', 'ffff',
        'asdf', 'qwer', 'zxcv', 'jklñ', 'poiu', 'lkjh', 'mnbv'
    ];
    
    if (combinacionesInvalidas.includes(apellido.toLowerCase())) {
        return { valid: false, message: "El apellido no es válido" };
    }
    
    // Verificar que no sean teclas adyacentes en el teclado
    const patronesTeclado = [
        /^[asdf]+$/i, /^[qwer]+$/i, /^[zxcv]+$/i, /^[jklñ]+$/i,
        /^[poiu]+$/i, /^[lkjh]+$/i, /^[mnbv]+$/i, /^[yuio]+$/i
    ];
    
    for (let palabra of palabras) {
        for (let patron of patronesTeclado) {
            if (patron.test(palabra.toLowerCase())) {
                return { valid: false, message: "El apellido contiene patrones de teclado no válidos" };
            }
        }
    }
    
    // CORREGIDO: Verificar que solo la primera letra sea mayúscula
    for (let palabra of palabras) {
        // Verificar que la primera letra sea mayúscula
        if (palabra.length > 0 && !/^[A-ZÁÉÍÓÚÑ]/.test(palabra)) {
            return { valid: false, message: "La primera letra de cada palabra debe ser mayúscula" };
        }
        
        // Verificar que el resto de letras sean minúsculas
        if (palabra.length > 1 && !/^[A-ZÁÉÍÓÚÑ][a-záéíóúñ]+$/.test(palabra)) {
            return { valid: false, message: "Solo la primera letra debe ser mayúscula, el resto minúsculas" };
        }
    }
    
    return { valid: true, message: "" };
}
        // Función para validar nombre



        // Función para validar email
        // Función para validar email
function validateEmail(email) {
    // Verificar formato básico de email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        return { valid: false, message: "Formato de email inválido" };
    }
    
    // Verificar que sea @gmail.com
    if (!email.endsWith('@gmail.com')) {
        return { valid: false, message: "Solo se permiten emails de @gmail.com" };
    }
    
    // Verificar longitud máxima total (30 caracteres)
    if (email.length > 30) {
        return { valid: false, message: "El email debe tener máximo 30 caracteres" };
    }
    
    // Obtener la parte antes del @
    const usuario = email.split('@')[0];
    
    // Verificar longitud mínima antes del @
    if (usuario.length < 3) {
        return { valid: false, message: "El email debe tener al menos 3 caracteres antes de @gmail.com" };
    }
    
    // Verificar caracteres permitidos antes del @ (solo letras, números, puntos)
    if (!/^[a-zA-Z0-9.]+$/.test(usuario)) {
        return { valid: false, message: "Solo se permiten letras, números y puntos antes de @gmail.com" };
    }
    
    // Verificar que no sean todos números
    if (/^\d+$/.test(usuario)) {
        return { valid: false, message: "El email no puede contener solo números antes de @gmail.com" };
    }
    
    // Verificar que no tenga puntos consecutivos
    if (/\.{2,}/.test(usuario)) {
        return { valid: false, message: "No se permiten puntos consecutivos" };
    }
    
    // Verificar que no empiece o termine con punto
    if (usuario.startsWith('.') || usuario.endsWith('.')) {
        return { valid: false, message: "El email no puede empezar o terminar con punto" };
    }
    
    // NUEVA VALIDACIÓN: Verificar que no tenga 3 letras iguales seguidas
    for (let i = 0; i < usuario.length - 2; i++) {
        if (usuario[i] === usuario[i+1] && usuario[i] === usuario[i+2]) {
            return { valid: false, message: "El email no puede tener 3 letras iguales seguidas" };
        }
    }
    
    // NUEVA VALIDACIÓN: Verificar patrones sin sentido específicos
    const patronesInvalidos = [
        /^(.)\1{2,}$/i, // 3+ letras iguales (aaa, bbb)
        /^(.)\1\1+$/i, // Múltiples letras iguales
        /^[aeiou]{3,}$/i, // Solo vocales
        /^[bcdfghjklmnpqrstvwxyz]{3,}$/i, // Solo consonantes
    ];
    
    for (let patron of patronesInvalidos) {
        if (patron.test(usuario)) {
            return { valid: false, message: "El email contiene patrones no válidos" };
        }
    }
    
    // NUEVA VALIDACIÓN: Verificar combinaciones específicas bloqueadas
    const combinacionesInvalidas = [
        'aaa', 'bbb', 'ccc', 'ddd', 'eee', 'fff', 'ggg', 'hhh', 'iii', 'jjj',
        'kkk', 'lll', 'mmm', 'nnn', 'ooo', 'ppp', 'qqq', 'rrr', 'sss', 'ttt',
        'uuu', 'vvv', 'www', 'xxx', 'yyy', 'zzz',
        'asdf', 'qwer', 'zxcv', 'jklñ', 'poiu', 'lkjh', 'mnbv'
    ];
    
    if (combinacionesInvalidas.includes(usuario.toLowerCase())) {
        return { valid: false, message: "El email no es válido" };
    }
    
    // NUEVA VALIDACIÓN: Verificar que no sean teclas adyacentes
    const patronesTeclado = [
        /^[asdf]+$/i, /^[qwer]+$/i, /^[zxcv]+$/i, /^[jklñ]+$/i,
        /^[poiu]+$/i, /^[lkjh]+$/i, /^[mnbv]+$/i, /^[yuio]+$/i
    ];
    
    for (let patron of patronesTeclado) {
        if (patron.test(usuario.toLowerCase())) {
            return { valid: false, message: "El email contiene patrones de teclado no válidos" };
        }
    }
    
    // NUEVA VALIDACIÓN: Verificar proporción vocal/consonante
    const vocales = (usuario.match(/[aeiouAEIOU]/g) || []).length;
    const consonantes = (usuario.match(/[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]/g) || []).length;
    const totalLetras = usuario.replace(/[^a-zA-Z]/g, '').length;
    
    if (totalLetras >= 4) {
        // Si tiene 4+ letras, debe tener al menos 1 vocal y 1 consonante
        if (vocales === 0 || consonantes === 0) {
            return { valid: false, message: "El email debe tener una combinación válida de vocales y consonantes" };
        }
        
        // No puede tener más del 80% del mismo tipo de caracteres
        if (vocales / totalLetras > 0.8 || consonantes / totalLetras > 0.8) {
            return { valid: false, message: "El email debe tener una combinación balanceada de vocales y consonantes" };
        }
    }
    
    return { valid: true, message: "" };
}
        // Función para validar contraseña
        function validatePassword(password) {
            // Verificar longitud
            if (password.length < 6 || password.length > 30) {
                return { valid: false, message: "La contraseña debe tener entre 6 y 30 caracteres" };
            }
            
            // Verificar mayúsculas
            if (!/[A-Z]/.test(password)) {
                return { valid: false, message: "La contraseña debe contener al menos una mayúscula" };
            }
            
            // Verificar minúsculas
            if (!/[a-z]/.test(password)) {
                return { valid: false, message: "La contraseña debe contener al menos una minúscula" };
            }
            
            // Verificar números
            if (!/\d/.test(password)) {
                return { valid: false, message: "La contraseña debe contener al menos un número" };
            }
            
            // Verificar caracteres especiales
            if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
                return { valid: false, message: "La contraseña debe contener al menos un carácter especial" };
            }
            
            return { valid: true, message: "" };
        }
        
        // Función para actualizar la visualización de los requisitos de contraseña
        function updatePasswordRequirements(password) {
            // Actualizar requisitos visualmente
            lengthReq.style.color = (password.length >= 6 && password.length <= 30) ? 'green' : 'red';
            uppercaseReq.style.color = /[A-Z]/.test(password) ? 'green' : 'red';
            lowercaseReq.style.color = /[a-z]/.test(password) ? 'green' : 'red';
            numberReq.style.color = /\d/.test(password) ? 'green' : 'red';
            specialReq.style.color = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password) ? 'green' : 'red';
        }
        
        // Función para actualizar estilos del input
        function updateInputStyle(input, isValid) {
            if (isValid) {
                input.style.borderColor = 'green';
                input.style.backgroundColor = '#f8fff8';
            } else {
                input.style.borderColor = 'red';
                input.style.backgroundColor = '#fff8f8';
            }
        }
        
        // Evento de entrada para nombre
        nombreInput.addEventListener('input', function() {
            const nombre = nombreInput.value;
            const validation = validateNombre(nombre);
            
            if (nombre === '') {
                nombreError.textContent = '';
                nombreInput.style.borderColor = '';
                nombreInput.style.backgroundColor = '';
            } else if (!validation.valid) {
                nombreError.textContent = validation.message;
                updateInputStyle(nombreInput, false);
            } else {
                nombreError.textContent = '';
                updateInputStyle(nombreInput, true);
            }
            
            // Validar también el apellido si ya tiene valor (para la comparación nombre≠apellido)
            if (apellidoInput.value !== '') {
                const apellidoValidation = validateApellido(apellidoInput.value, nombreInput.value);
                if (!apellidoValidation.valid) {
                    apellidoError.textContent = apellidoValidation.message;
                    updateInputStyle(apellidoInput, false);
                } else {
                    apellidoError.textContent = '';
                    updateInputStyle(apellidoInput, true);
                }
            }
        });
        
        // Evento de entrada para apellido
        apellidoInput.addEventListener('input', function() {
            const apellido = apellidoInput.value;
            const nombre = nombreInput.value;
            const validation = validateApellido(apellido, nombre);
            
            if (apellido === '') {
                apellidoError.textContent = '';
                apellidoInput.style.borderColor = '';
                apellidoInput.style.backgroundColor = '';
            } else if (!validation.valid) {
                apellidoError.textContent = validation.message;
                updateInputStyle(apellidoInput, false);
            } else {
                apellidoError.textContent = '';
                updateInputStyle(apellidoInput, true);
            }
        });
        
        // Evento de entrada para email
        emailInput.addEventListener('input', function() {
            const email = emailInput.value.trim();
            
            if (email === '') {
                emailError.textContent = '';
                emailInput.style.borderColor = '';
                emailInput.style.backgroundColor = '';
            } else if (!validateEmail(email).valid) {
                emailError.textContent = validateEmail(email).message;
                updateInputStyle(emailInput, false);
            } else {
                emailError.textContent = '';
                updateInputStyle(emailInput, true);
            }
        });
        
        // Evento de entrada para contraseña
        passwordInput.addEventListener('input', function() {
            const password = passwordInput.value;
            
            if (password === '') {
                passwordError.textContent = '';
                passwordInput.style.borderColor = '';
                passwordInput.style.backgroundColor = '';
                updatePasswordRequirements('');
            } else {
                const validation = validatePassword(password);
                
                if (!validation.valid) {
                    passwordError.textContent = validation.message;
                    updateInputStyle(passwordInput, false);
                } else {
                    passwordError.textContent = '';
                    updateInputStyle(passwordInput, true);
                }
                
                updatePasswordRequirements(password);
            }
        });
        
        // Evento de envío del formulario
        registroForm.addEventListener('submit', function(event) {
            const nombre = nombreInput.value;
            const apellido = apellidoInput.value;
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            
            let hasErrors = false;
            
            // Validar nombre
            const nombreValidation = validateNombre(nombre);
            if (!nombreValidation.valid) {
                nombreError.textContent = nombreValidation.message;
                updateInputStyle(nombreInput, false);
                hasErrors = true;
            } else {
                nombreError.textContent = '';
            }
            
            // Validar apellido
            const apellidoValidation = validateApellido(apellido, nombre);
            if (!apellidoValidation.valid) {
                apellidoError.textContent = apellidoValidation.message;
                updateInputStyle(apellidoInput, false);
                hasErrors = true;
            } else {
                apellidoError.textContent = '';
            }
            
            // Validar email
            const emailValidation = validateEmail(email);
            if (!emailValidation.valid) {
                emailError.textContent = emailValidation.message;
                updateInputStyle(emailInput, false);
                hasErrors = true;
            } else {
                emailError.textContent = '';
            }
            
            // Validar contraseña
            const passwordValidation = validatePassword(password);
            if (!passwordValidation.valid) {
                passwordError.textContent = passwordValidation.message;
                updateInputStyle(passwordInput, false);
                hasErrors = true;
            } else {
                passwordError.textContent = '';
            }
            
            // Prevenir envío si hay errores
            if (hasErrors) {
                event.preventDefault();
                // Hacer scroll al primer error
                const firstError = document.querySelector('.error-message:not(:empty)');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    });
</script>
</body>
</html>